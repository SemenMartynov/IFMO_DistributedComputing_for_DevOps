services:
  db-master:
    image: bitnami/mariadb-galera:latest
    container_name: db-master
    restart: always
    environment:
      - MARIADB_ROOT_PASSWORD=supersecure
      - MARIADB_DATABASE=wpdb
      - MARIADB_USER=wpuser
      - MARIADB_PASSWORD=wp_pass
      - MARIADB_GALERA_CLUSTER_NAME=galera_cluster
      - MARIADB_GALERA_CLUSTER_BOOTSTRAP=yes
      - MARIADB_GALERA_FORCE_SAFETOBOOTSTRAP=yes
      - MARIADB_GALERA_MARIABACKUP_USER=backup
      - MARIADB_GALERA_MARIABACKUP_PASSWORD=backup_pass
      - MARIADB_REPLICATION_USER=replicator
      - MARIADB_REPLICATION_PASSWORD=repl_pass
    volumes:
      - db_master_data:/bitnami/mariadb
    networks:
      - wpnet

  db-slave:
    image: bitnami/mariadb-galera:latest
    container_name: db-slave
    restart: always
    environment:
      - MARIADB_ROOT_PASSWORD=supersecure
      - MARIADB_DATABASE=wpdb
      - MARIADB_USER=wpuser
      - MARIADB_PASSWORD=wp_pass
      - MARIADB_GALERA_CLUSTER_NAME=galera_cluster
      - MARIADB_GALERA_CLUSTER_ADDRESS=gcomm://db-master
      - MARIADB_GALERA_MARIABACKUP_USER=backup
      - MARIADB_GALERA_MARIABACKUP_PASSWORD=backup_pass
      - MARIADB_REPLICATION_USER=replicator
      - MARIADB_REPLICATION_PASSWORD=repl_pass
    volumes:
      - db_slave_data:/bitnami/mariadb
    networks:
      - wpnet

  wordpress:
    image: wordpress:6.7
    depends_on:
      - db-master
      - db-slave
    ports:
      - "80:80"
    environment:
      - WORDPRESS_DB_HOST=db-master
      - WORDPRESS_DB_USER=wpuser
      - WORDPRESS_DB_PASSWORD=wp_pass
      - WORDPRESS_DB_NAME=wpdb
    networks:
      - wpnet

volumes:
  db_master_data:
  db_slave_data:

networks:
  wpnet:
