- name: Create Docker network
  community.docker.docker_network:
    name: monitoring_net
    driver: bridge

- name: Check if Prometheus config directory exists
  ansible.builtin.file:
    path: "/opt/prometheus"
    state: directory
    owner: root
    group: root
    mode: "0755"

- name: Generate prometheus.yml from j2 template
  ansible.builtin.template:
    src: "prometheus.yml.j2"
    dest: "/opt/prometheus/prometheus.yml"
    owner: root
    group: root
    mode: "0644"

- name: Start Prometheus in Docker
  community.docker.docker_container:
    name: "prometheus"
    image: "prom/prometheus"
    state: started
    restart_policy: always
    networks:
      - name: monitoring_net
    ports:
      - "9090:9090"
    volumes:
      - "/opt/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro"
