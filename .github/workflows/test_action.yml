name: Docker Image CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:

  build:

    runs-on: ubuntu-latest
    steps:
    - name: "Generate test inventory"
      run: |
         echo '[servers]' > test-inv
         echo 'server1 ansible_host=127.0.0.1' >> test-inv

    - uses: actions/checkout@v4

    - name: Setup and Run Ansible
      uses: alex-oleshkevich/ansible-playbook@v1.0.0
      with:
        version: "9.3.0"
        private-key: |
                -----BEGIN OPENSSH PRIVATE KEY-----
                b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
                QyNTUxOQAAACBO/dqLgtV78Tq2Y+1OGm5SY2bym4WNY0dtfP/92LYYtQAAAJDHbnLlx25y
                5QAAAAtzc2gtZWQyNTUxOQAAACBO/dqLgtV78Tq2Y+1OGm5SY2bym4WNY0dtfP/92LYYtQ
                AAAEDPqDO80rVJjovlesCfGCn4IpJG+gePVKIXKiMYV5dkpE792ouC1XvxOrZj7U4ablJj
                ZvKbhY1jR218//3Ythi1AAAACGFsZXhAeHBzAQIDBAU=
                -----END OPENSSH PRIVATE KEY-----
        become-password: "password"
        become-user: "root"
        become-method: "sudo"
        inventory-file: "test-inv"
        playbook-file: "wp-mysql-playbook.yml"
        
    - name: "Print Ansible version"
      run: ansible-playbook --version
