name: Docker Image CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:

  build:

    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: "Install Ansible"
      run: pip install ansible

    - name: "Print Ansible version"
      run: ansible-playbook --version
      
    - name: "Generate ansible.cfg"
      run: |
        echo '[defaults]' > .ansible.cfg
        echo 'hostfile = ~/.ansible-hosts'  >> .ansible.cfg
        echo 'inventory = ~/.ansible-hosts' >> .ansible.cfg

    - name: "Generate localhost inventory"
      run: echo 'localhost ansible_connection=local' > .ansible-hosts

    - name: Run Ansible Playbook
      run: ansible-playbook wp-mysql-playbook.yml
