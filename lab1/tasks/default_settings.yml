- name: Update repositories cache and install "ca-certificates" package
  apt:
    pkg:
      - ca-certificates
      - curl
      - python3
      - python3-virtualenv
      - python3-pip
    update_cache: yes

- name: Create Python3-virtual environment folder
  file:
    name: /opt/ansible_venv
    mode: 0755
    state: directory

- name: Install Python modules in virtual environment
  ansible.builtin.pip:
    name:
      - PyMySQL
      - mysql-connector-python
      - cryptography
      - requests
    virtualenv: /opt/ansible_venv
    virtualenv_python: python3
    state: present

- name: Set Python interpreter to virtual environment
  set_fact:
    ansible_python_interpreter: /opt/ansible_venv/bin/python

- name: Setup timezone
  shell:
    cmd: "timedatectl set-timezone {{time_zone}}"
  when: "ansible_date_time.tz != time_zone"

- name: Setup locale settings
  shell:
    cmd: 'locale-gen {{locale1}} && update-locale LANG={{locale2}} LC_TIME={{locale1}}'
  when:
    - "ansible_env.LANG != locale2"
    - "ansible_env.LC_TIME != locale1"