- name: Create necessary directories
  file:
    path: "{{ item.path }}"
    state: directory
    mode: "{{ item.mode }}"
  with_items:
    - { path: "{{ vol_nginx_www }}", mode: '0755' }
    - { path: "{{ vol_nginx_conf }}", mode: '0755' }
    - { path: "{{ vol_db_data }}", mode: '0755' }
    - { path: "{{ vol_db_conf }}", mode: '0755' }
    - { path: "{{ vol_db_data_slave }}", mode: '0755' }
    - { path: "{{ vol_db_conf_slave }}", mode: '0755' }


- name: Copy Nginx conf files
  copy:
    src: files/nginx.conf
    dest: "{{vol_nginx_conf}}"

- name: Create Docker network app_network
  community.docker.docker_network:
    name: app_network
    driver: bridge
    state: present

- name: Copy Docker Compose files
  copy:
    src: files/docker-compose.yml
    dest: /data/docker-compose.yml
  notify: "restart docker-compose"

- name: Copy Docker Compose slave sql files
  copy:
    src: files/docker-compose-slave-sql.yml
    dest: /data/docker-compose-slave-sql.yml
  notify: "restart docker-compose-slave-sql"
